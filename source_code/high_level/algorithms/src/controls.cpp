#include "controls.h"

Joint_Angles_Two_Legs Controls::controlZMPPos(const Direction_Vector &act_ZMP_pos, const Direction_Vector &ref_ZMP_pos, const Joint_Angles_Two_Legs &act_joint_angles, const FusionMatrix &rotation_matrix)
{
    // Initialize the position error
    Eigen::Vector3f v_ref_ZMP_pos(ref_ZMP_pos.x, ref_ZMP_pos.y, ref_ZMP_pos.z);
    Eigen::Vector3f v_act_ZMP_pos(act_ZMP_pos.x, act_ZMP_pos.y, act_ZMP_pos.z);
    Eigen::Vector3f v_ZMP_pos_error = ZMP_ERROR_GAIN * (v_ref_ZMP_pos - v_act_ZMP_pos);

    Joint_Angles_Two_Legs computed_joint_angles = act_joint_angles;
    Eigen::VectorXf v_delta_joint_angles(6);

    // Initialize the Jacobian matrix
    Eigen::MatrixXf m_Jacobian(3, 6);
    m_Jacobian(0, 0) = (rotation_matrix.array[0][0] * cosf(computed_joint_angles.left.hip_yaw) * (C3.z * M3 * cosf(computed_joint_angles.left.hip_roll) - C3.x * M3 * sinf(computed_joint_angles.left.hip_roll) - C4.x * M4 * sinf(computed_joint_angles.left.hip_roll) - C5.x * M5 * sinf(computed_joint_angles.left.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) - L4 * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) + C4.y * M4 * cosf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_pitch) - C5.z * M5 * cosf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[0][2] * (C3.x * M3 * cosf(computed_joint_angles.left.hip_roll) + C4.x * M4 * cosf(computed_joint_angles.left.hip_roll) + C5.x * M5 * cosf(computed_joint_angles.left.hip_roll) + C3.z * M3 * sinf(computed_joint_angles.left.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) - L4 * M5 * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) + C4.y * M4 * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) + C5.y * M5 * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) - C5.z * M5 * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[0][1] * sinf(computed_joint_angles.left.hip_yaw) * (C3.z * M3 * cosf(computed_joint_angles.left.hip_roll) - C3.x * M3 * sinf(computed_joint_angles.left.hip_roll) - C4.x * M4 * sinf(computed_joint_angles.left.hip_roll) - C5.x * M5 * sinf(computed_joint_angles.left.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) - L4 * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) + C4.y * M4 * cosf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_pitch) - C5.z * M5 * cosf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);
    m_Jacobian(0, 1) = (rotation_matrix.array[0][2] * cosf(computed_joint_angles.left.hip_roll) * (L4 * M5 * sinf(computed_joint_angles.left.hip_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.hip_pitch + computed_joint_angles.left.knee_pitch) - C5.z * M5 * sinf(computed_joint_angles.left.hip_pitch + computed_joint_angles.left.knee_pitch) + C4.y * M4 * cosf(computed_joint_angles.left.hip_pitch) - C4.z * M4 * sinf(computed_joint_angles.left.hip_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[0][1] * (M4 * (C4.z * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) + C4.y * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) + C4.y * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) - C4.z * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch)) - M5 * (L4 * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) - C5.z * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) - C5.y * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - C5.y * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_pitch) + C5.z * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - L4 * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) - C5.y * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) + C5.z * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.knee_pitch) + C5.z * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.y * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch)))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[0][0] * (M4 * (C4.z * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) + C4.y * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) - C4.y * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) + C4.z * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch)) + M5 * (C5.z * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) - L4 * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) + C5.y * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) - L4 * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) - C5.z * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - C5.y * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) + C5.z * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.knee_pitch) + C5.z * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.y * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch)))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);
    m_Jacobian(0, 2) = -(M5 * (C5.z * rotation_matrix.array[0][2] * sinf(computed_joint_angles.left.hip_pitch + computed_joint_angles.left.knee_pitch) * cosf(computed_joint_angles.left.hip_roll) - C5.y * rotation_matrix.array[0][2] * cosf(computed_joint_angles.left.hip_pitch + computed_joint_angles.left.knee_pitch) * cosf(computed_joint_angles.left.hip_roll) + C5.z * rotation_matrix.array[0][1] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) + C5.y * rotation_matrix.array[0][1] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * rotation_matrix.array[0][1] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_pitch) + C5.z * rotation_matrix.array[0][0] * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) + C5.y * rotation_matrix.array[0][0] * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * rotation_matrix.array[0][0] * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) - C5.z * rotation_matrix.array[0][1] * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - C5.z * rotation_matrix.array[0][0] * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - C5.y * rotation_matrix.array[0][0] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) + C5.y * rotation_matrix.array[0][1] * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) + C5.z * rotation_matrix.array[0][0] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.knee_pitch) + C5.z * rotation_matrix.array[0][0] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.y * rotation_matrix.array[0][0] * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - C5.z * rotation_matrix.array[0][1] * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.knee_pitch) - C5.z * rotation_matrix.array[0][1] * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) - C5.y * rotation_matrix.array[0][1] * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);
    m_Jacobian(0, 3) = (rotation_matrix.array[0][0] * cosf(computed_joint_angles.right.hip_yaw) * (C3.z * M3 * cosf(computed_joint_angles.right.hip_roll) - C3.x * M3 * sinf(computed_joint_angles.right.hip_roll) - C4.x * M4 * sinf(computed_joint_angles.right.hip_roll) - C5.x * M5 * sinf(computed_joint_angles.right.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) - L4 * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) + C4.y * M4 * cosf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_pitch) - C5.z * M5 * cosf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[0][2] * (C3.x * M3 * cosf(computed_joint_angles.right.hip_roll) + C4.x * M4 * cosf(computed_joint_angles.right.hip_roll) + C5.x * M5 * cosf(computed_joint_angles.right.hip_roll) + C3.z * M3 * sinf(computed_joint_angles.right.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) - L4 * M5 * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) + C4.y * M4 * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) + C5.y * M5 * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) - C5.z * M5 * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[0][1] * sinf(computed_joint_angles.right.hip_yaw) * (C3.z * M3 * cosf(computed_joint_angles.right.hip_roll) - C3.x * M3 * sinf(computed_joint_angles.right.hip_roll) - C4.x * M4 * sinf(computed_joint_angles.right.hip_roll) - C5.x * M5 * sinf(computed_joint_angles.right.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) - L4 * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) + C4.y * M4 * cosf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_pitch) - C5.z * M5 * cosf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);
    m_Jacobian(0, 4) = (rotation_matrix.array[0][2] * cosf(computed_joint_angles.right.hip_roll) * (L4 * M5 * sinf(computed_joint_angles.right.hip_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.hip_pitch + computed_joint_angles.right.knee_pitch) - C5.z * M5 * sinf(computed_joint_angles.right.hip_pitch + computed_joint_angles.right.knee_pitch) + C4.y * M4 * cosf(computed_joint_angles.right.hip_pitch) - C4.z * M4 * sinf(computed_joint_angles.right.hip_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[0][1] * (M4 * (C4.z * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) + C4.y * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) + C4.y * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) - C4.z * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch)) - M5 * (L4 * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) - C5.z * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) - C5.y * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - C5.y * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_pitch) + C5.z * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - L4 * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) - C5.y * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) + C5.z * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.knee_pitch) + C5.z * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.y * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch)))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[0][0] * (M4 * (C4.z * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) + C4.y * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) - C4.y * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) + C4.z * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch)) + M5 * (C5.z * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) - L4 * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) + C5.y * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) - L4 * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) - C5.z * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - C5.y * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) + C5.z * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.knee_pitch) + C5.z * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.y * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch)))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);
    m_Jacobian(0, 5) = -(M5 * (C5.z * rotation_matrix.array[0][2] * sinf(computed_joint_angles.right.hip_pitch + computed_joint_angles.right.knee_pitch) * cosf(computed_joint_angles.right.hip_roll) - C5.y * rotation_matrix.array[0][2] * cosf(computed_joint_angles.right.hip_pitch + computed_joint_angles.right.knee_pitch) * cosf(computed_joint_angles.right.hip_roll) + C5.z * rotation_matrix.array[0][1] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) + C5.y * rotation_matrix.array[0][1] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * rotation_matrix.array[0][1] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_pitch) + C5.z * rotation_matrix.array[0][0] * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) + C5.y * rotation_matrix.array[0][0] * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * rotation_matrix.array[0][0] * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) - C5.z * rotation_matrix.array[0][1] * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - C5.z * rotation_matrix.array[0][0] * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - C5.y * rotation_matrix.array[0][0] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) + C5.y * rotation_matrix.array[0][1] * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) + C5.z * rotation_matrix.array[0][0] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.knee_pitch) + C5.z * rotation_matrix.array[0][0] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.y * rotation_matrix.array[0][0] * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - C5.z * rotation_matrix.array[0][1] * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.knee_pitch) - C5.z * rotation_matrix.array[0][1] * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) - C5.y * rotation_matrix.array[0][1] * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);
    m_Jacobian(1, 0) = (rotation_matrix.array[1][0] * cosf(computed_joint_angles.left.hip_yaw) * (C3.z * M3 * cosf(computed_joint_angles.left.hip_roll) - C3.x * M3 * sinf(computed_joint_angles.left.hip_roll) - C4.x * M4 * sinf(computed_joint_angles.left.hip_roll) - C5.x * M5 * sinf(computed_joint_angles.left.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) - L4 * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) + C4.y * M4 * cosf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_pitch) - C5.z * M5 * cosf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[1][2] * (C3.x * M3 * cosf(computed_joint_angles.left.hip_roll) + C4.x * M4 * cosf(computed_joint_angles.left.hip_roll) + C5.x * M5 * cosf(computed_joint_angles.left.hip_roll) + C3.z * M3 * sinf(computed_joint_angles.left.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) - L4 * M5 * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) + C4.y * M4 * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) + C5.y * M5 * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) - C5.z * M5 * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[1][1] * sinf(computed_joint_angles.left.hip_yaw) * (C3.z * M3 * cosf(computed_joint_angles.left.hip_roll) - C3.x * M3 * sinf(computed_joint_angles.left.hip_roll) - C4.x * M4 * sinf(computed_joint_angles.left.hip_roll) - C5.x * M5 * sinf(computed_joint_angles.left.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) - L4 * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) + C4.y * M4 * cosf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_pitch) - C5.z * M5 * cosf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);
    m_Jacobian(1, 1) = (rotation_matrix.array[1][2] * cosf(computed_joint_angles.left.hip_roll) * (L4 * M5 * sinf(computed_joint_angles.left.hip_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.hip_pitch + computed_joint_angles.left.knee_pitch) - C5.z * M5 * sinf(computed_joint_angles.left.hip_pitch + computed_joint_angles.left.knee_pitch) + C4.y * M4 * cosf(computed_joint_angles.left.hip_pitch) - C4.z * M4 * sinf(computed_joint_angles.left.hip_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[1][1] * (M4 * (C4.z * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) + C4.y * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) + C4.y * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) - C4.z * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch)) - M5 * (L4 * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) - C5.z * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) - C5.y * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - C5.y * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_pitch) + C5.z * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - L4 * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) - C5.y * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) + C5.z * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.knee_pitch) + C5.z * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.y * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch)))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[1][0] * (M4 * (C4.z * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) + C4.y * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) - C4.y * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) + C4.z * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch)) + M5 * (C5.z * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) - L4 * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) + C5.y * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) - L4 * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) - C5.z * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - C5.y * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) + C5.z * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.knee_pitch) + C5.z * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.y * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch)))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);
    m_Jacobian(1, 2) = -(M5 * (C5.z * rotation_matrix.array[1][2] * sinf(computed_joint_angles.left.hip_pitch + computed_joint_angles.left.knee_pitch) * cosf(computed_joint_angles.left.hip_roll) - C5.y * rotation_matrix.array[1][2] * cosf(computed_joint_angles.left.hip_pitch + computed_joint_angles.left.knee_pitch) * cosf(computed_joint_angles.left.hip_roll) + C5.z * rotation_matrix.array[1][1] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) + C5.y * rotation_matrix.array[1][1] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * rotation_matrix.array[1][1] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_pitch) + C5.z * rotation_matrix.array[1][0] * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) + C5.y * rotation_matrix.array[1][0] * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * rotation_matrix.array[1][0] * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) - C5.z * rotation_matrix.array[1][1] * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - C5.z * rotation_matrix.array[1][0] * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - C5.y * rotation_matrix.array[1][0] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) + C5.y * rotation_matrix.array[1][1] * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) + C5.z * rotation_matrix.array[1][0] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.knee_pitch) + C5.z * rotation_matrix.array[1][0] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.y * rotation_matrix.array[1][0] * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - C5.z * rotation_matrix.array[1][1] * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.knee_pitch) - C5.z * rotation_matrix.array[1][1] * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) - C5.y * rotation_matrix.array[1][1] * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);
    m_Jacobian(1, 3) = (rotation_matrix.array[1][0] * cosf(computed_joint_angles.right.hip_yaw) * (C3.z * M3 * cosf(computed_joint_angles.right.hip_roll) - C3.x * M3 * sinf(computed_joint_angles.right.hip_roll) - C4.x * M4 * sinf(computed_joint_angles.right.hip_roll) - C5.x * M5 * sinf(computed_joint_angles.right.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) - L4 * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) + C4.y * M4 * cosf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_pitch) - C5.z * M5 * cosf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[1][2] * (C3.x * M3 * cosf(computed_joint_angles.right.hip_roll) + C4.x * M4 * cosf(computed_joint_angles.right.hip_roll) + C5.x * M5 * cosf(computed_joint_angles.right.hip_roll) + C3.z * M3 * sinf(computed_joint_angles.right.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) - L4 * M5 * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) + C4.y * M4 * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) + C5.y * M5 * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) - C5.z * M5 * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[1][1] * sinf(computed_joint_angles.right.hip_yaw) * (C3.z * M3 * cosf(computed_joint_angles.right.hip_roll) - C3.x * M3 * sinf(computed_joint_angles.right.hip_roll) - C4.x * M4 * sinf(computed_joint_angles.right.hip_roll) - C5.x * M5 * sinf(computed_joint_angles.right.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) - L4 * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) + C4.y * M4 * cosf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_pitch) - C5.z * M5 * cosf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);
    m_Jacobian(1, 4) = (rotation_matrix.array[1][2] * cosf(computed_joint_angles.right.hip_roll) * (L4 * M5 * sinf(computed_joint_angles.right.hip_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.hip_pitch + computed_joint_angles.right.knee_pitch) - C5.z * M5 * sinf(computed_joint_angles.right.hip_pitch + computed_joint_angles.right.knee_pitch) + C4.y * M4 * cosf(computed_joint_angles.right.hip_pitch) - C4.z * M4 * sinf(computed_joint_angles.right.hip_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[1][1] * (M4 * (C4.z * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) + C4.y * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) + C4.y * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) - C4.z * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch)) - M5 * (L4 * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) - C5.z * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) - C5.y * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - C5.y * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_pitch) + C5.z * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - L4 * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) - C5.y * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) + C5.z * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.knee_pitch) + C5.z * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.y * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch)))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[1][0] * (M4 * (C4.z * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) + C4.y * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) - C4.y * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) + C4.z * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch)) + M5 * (C5.z * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) - L4 * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) + C5.y * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) - L4 * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) - C5.z * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - C5.y * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) + C5.z * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.knee_pitch) + C5.z * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.y * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch)))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);
    m_Jacobian(1, 5) = -(M5 * (C5.z * rotation_matrix.array[1][2] * sinf(computed_joint_angles.right.hip_pitch + computed_joint_angles.right.knee_pitch) * cosf(computed_joint_angles.right.hip_roll) - C5.y * rotation_matrix.array[1][2] * cosf(computed_joint_angles.right.hip_pitch + computed_joint_angles.right.knee_pitch) * cosf(computed_joint_angles.right.hip_roll) + C5.z * rotation_matrix.array[1][1] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) + C5.y * rotation_matrix.array[1][1] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * rotation_matrix.array[1][1] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_pitch) + C5.z * rotation_matrix.array[1][0] * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) + C5.y * rotation_matrix.array[1][0] * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * rotation_matrix.array[1][0] * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) - C5.z * rotation_matrix.array[1][1] * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - C5.z * rotation_matrix.array[1][0] * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - C5.y * rotation_matrix.array[1][0] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) + C5.y * rotation_matrix.array[1][1] * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) + C5.z * rotation_matrix.array[1][0] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.knee_pitch) + C5.z * rotation_matrix.array[1][0] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.y * rotation_matrix.array[1][0] * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - C5.z * rotation_matrix.array[1][1] * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.knee_pitch) - C5.z * rotation_matrix.array[1][1] * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) - C5.y * rotation_matrix.array[1][1] * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);
    m_Jacobian(2, 0) = (rotation_matrix.array[2][0] * cosf(computed_joint_angles.left.hip_yaw) * (C3.z * M3 * cosf(computed_joint_angles.left.hip_roll) - C3.x * M3 * sinf(computed_joint_angles.left.hip_roll) - C4.x * M4 * sinf(computed_joint_angles.left.hip_roll) - C5.x * M5 * sinf(computed_joint_angles.left.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) - L4 * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) + C4.y * M4 * cosf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_pitch) - C5.z * M5 * cosf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[2][2] * (C3.x * M3 * cosf(computed_joint_angles.left.hip_roll) + C4.x * M4 * cosf(computed_joint_angles.left.hip_roll) + C5.x * M5 * cosf(computed_joint_angles.left.hip_roll) + C3.z * M3 * sinf(computed_joint_angles.left.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) - L4 * M5 * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) + C4.y * M4 * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) + C5.y * M5 * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) - C5.z * M5 * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[2][1] * sinf(computed_joint_angles.left.hip_yaw) * (C3.z * M3 * cosf(computed_joint_angles.left.hip_roll) - C3.x * M3 * sinf(computed_joint_angles.left.hip_roll) - C4.x * M4 * sinf(computed_joint_angles.left.hip_roll) - C5.x * M5 * sinf(computed_joint_angles.left.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) - L4 * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) + C4.y * M4 * cosf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.hip_roll) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_pitch) - C5.z * M5 * cosf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);
    m_Jacobian(2, 1) = (rotation_matrix.array[2][2] * cosf(computed_joint_angles.left.hip_roll) * (L4 * M5 * sinf(computed_joint_angles.left.hip_pitch) + C5.y * M5 * cosf(computed_joint_angles.left.hip_pitch + computed_joint_angles.left.knee_pitch) - C5.z * M5 * sinf(computed_joint_angles.left.hip_pitch + computed_joint_angles.left.knee_pitch) + C4.y * M4 * cosf(computed_joint_angles.left.hip_pitch) - C4.z * M4 * sinf(computed_joint_angles.left.hip_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[2][1] * (M4 * (C4.z * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) + C4.y * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) + C4.y * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) - C4.z * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch)) - M5 * (L4 * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) - C5.z * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) - C5.y * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - C5.y * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_pitch) + C5.z * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - L4 * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) - C5.y * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) + C5.z * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.knee_pitch) + C5.z * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.y * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch)))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[2][0] * (M4 * (C4.z * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) + C4.y * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) - C4.y * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) + C4.z * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch)) + M5 * (C5.z * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) - L4 * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) + C5.y * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) - L4 * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) - C5.z * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - C5.y * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) + C5.z * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.knee_pitch) + C5.z * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.y * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch)))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);
    m_Jacobian(2, 2) = -(M5 * (C5.z * rotation_matrix.array[2][2] * sinf(computed_joint_angles.left.hip_pitch + computed_joint_angles.left.knee_pitch) * cosf(computed_joint_angles.left.hip_roll) - C5.y * rotation_matrix.array[2][2] * cosf(computed_joint_angles.left.hip_pitch + computed_joint_angles.left.knee_pitch) * cosf(computed_joint_angles.left.hip_roll) + C5.z * rotation_matrix.array[2][1] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) + C5.y * rotation_matrix.array[2][1] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * rotation_matrix.array[2][1] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_pitch) + C5.z * rotation_matrix.array[2][0] * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) + C5.y * rotation_matrix.array[2][0] * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.knee_pitch) + C5.y * rotation_matrix.array[2][0] * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) - C5.z * rotation_matrix.array[2][1] * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - C5.z * rotation_matrix.array[2][0] * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - C5.y * rotation_matrix.array[2][0] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) + C5.y * rotation_matrix.array[2][1] * cosf(computed_joint_angles.left.hip_pitch) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) + C5.z * rotation_matrix.array[2][0] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.knee_pitch) + C5.z * rotation_matrix.array[2][0] * cosf(computed_joint_angles.left.hip_yaw) * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) + C5.y * rotation_matrix.array[2][0] * cosf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch) - C5.z * rotation_matrix.array[2][1] * cosf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.knee_pitch) - C5.z * rotation_matrix.array[2][1] * cosf(computed_joint_angles.left.knee_pitch) * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) - C5.y * rotation_matrix.array[2][1] * sinf(computed_joint_angles.left.hip_yaw) * sinf(computed_joint_angles.left.hip_roll) * sinf(computed_joint_angles.left.hip_pitch) * sinf(computed_joint_angles.left.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);
    m_Jacobian(2, 3) = (rotation_matrix.array[2][0] * cosf(computed_joint_angles.right.hip_yaw) * (C3.z * M3 * cosf(computed_joint_angles.right.hip_roll) - C3.x * M3 * sinf(computed_joint_angles.right.hip_roll) - C4.x * M4 * sinf(computed_joint_angles.right.hip_roll) - C5.x * M5 * sinf(computed_joint_angles.right.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) - L4 * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) + C4.y * M4 * cosf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_pitch) - C5.z * M5 * cosf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[2][2] * (C3.x * M3 * cosf(computed_joint_angles.right.hip_roll) + C4.x * M4 * cosf(computed_joint_angles.right.hip_roll) + C5.x * M5 * cosf(computed_joint_angles.right.hip_roll) + C3.z * M3 * sinf(computed_joint_angles.right.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) - L4 * M5 * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) + C4.y * M4 * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) + C5.y * M5 * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) - C5.z * M5 * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[2][1] * sinf(computed_joint_angles.right.hip_yaw) * (C3.z * M3 * cosf(computed_joint_angles.right.hip_roll) - C3.x * M3 * sinf(computed_joint_angles.right.hip_roll) - C4.x * M4 * sinf(computed_joint_angles.right.hip_roll) - C5.x * M5 * sinf(computed_joint_angles.right.hip_roll) + C4.z * M4 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) - L4 * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) + C4.y * M4 * cosf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.z * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.hip_roll) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_pitch) - C5.z * M5 * cosf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);
    m_Jacobian(2, 4) = (rotation_matrix.array[2][2] * cosf(computed_joint_angles.right.hip_roll) * (L4 * M5 * sinf(computed_joint_angles.right.hip_pitch) + C5.y * M5 * cosf(computed_joint_angles.right.hip_pitch + computed_joint_angles.right.knee_pitch) - C5.z * M5 * sinf(computed_joint_angles.right.hip_pitch + computed_joint_angles.right.knee_pitch) + C4.y * M4 * cosf(computed_joint_angles.right.hip_pitch) - C4.z * M4 * sinf(computed_joint_angles.right.hip_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[2][1] * (M4 * (C4.z * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) + C4.y * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) + C4.y * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) - C4.z * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch)) - M5 * (L4 * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) - C5.z * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) - C5.y * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - C5.y * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_pitch) + C5.z * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - L4 * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) - C5.y * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) + C5.z * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.knee_pitch) + C5.z * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.y * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch)))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5) - (rotation_matrix.array[2][0] * (M4 * (C4.z * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) + C4.y * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) - C4.y * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) + C4.z * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch)) + M5 * (C5.z * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) - L4 * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) + C5.y * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) - L4 * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) - C5.z * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - C5.y * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) + C5.z * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.knee_pitch) + C5.z * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.y * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch)))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);
    m_Jacobian(2, 5) = -(M5 * (C5.z * rotation_matrix.array[2][2] * sinf(computed_joint_angles.right.hip_pitch + computed_joint_angles.right.knee_pitch) * cosf(computed_joint_angles.right.hip_roll) - C5.y * rotation_matrix.array[2][2] * cosf(computed_joint_angles.right.hip_pitch + computed_joint_angles.right.knee_pitch) * cosf(computed_joint_angles.right.hip_roll) + C5.z * rotation_matrix.array[2][1] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) + C5.y * rotation_matrix.array[2][1] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * rotation_matrix.array[2][1] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_pitch) + C5.z * rotation_matrix.array[2][0] * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) + C5.y * rotation_matrix.array[2][0] * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.knee_pitch) + C5.y * rotation_matrix.array[2][0] * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) - C5.z * rotation_matrix.array[2][1] * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - C5.z * rotation_matrix.array[2][0] * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - C5.y * rotation_matrix.array[2][0] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) + C5.y * rotation_matrix.array[2][1] * cosf(computed_joint_angles.right.hip_pitch) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) + C5.z * rotation_matrix.array[2][0] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.knee_pitch) + C5.z * rotation_matrix.array[2][0] * cosf(computed_joint_angles.right.hip_yaw) * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) + C5.y * rotation_matrix.array[2][0] * cosf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch) - C5.z * rotation_matrix.array[2][1] * cosf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.knee_pitch) - C5.z * rotation_matrix.array[2][1] * cosf(computed_joint_angles.right.knee_pitch) * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) - C5.y * rotation_matrix.array[2][1] * sinf(computed_joint_angles.right.hip_yaw) * sinf(computed_joint_angles.right.hip_roll) * sinf(computed_joint_angles.right.hip_pitch) * sinf(computed_joint_angles.right.knee_pitch))) / (M1 + 2 * M2 + 2 * M3 + 2 * M4 + 2 * M5);

    // SR Inverse using Levenberg-Marquardt method solved using ldlt decomposition as in this Ax = b, A is symmetric and positive definite
    v_delta_joint_angles = (m_Jacobian.transpose() * m_Jacobian + LAMBDA * Eigen::MatrixXf::Identity(6, 6)).ldlt().solve(m_Jacobian.transpose() * v_ZMP_pos_error);

    computed_joint_angles.left.hip_yaw = 0.0f;
    computed_joint_angles.left.hip_roll += v_delta_joint_angles(0);
    computed_joint_angles.left.hip_pitch += v_delta_joint_angles(1);
    computed_joint_angles.left.knee_pitch += v_delta_joint_angles(2);
    computed_joint_angles.right.hip_yaw = 0.0f;
    computed_joint_angles.right.hip_roll += v_delta_joint_angles(3);
    computed_joint_angles.right.hip_pitch += v_delta_joint_angles(4);
    computed_joint_angles.right.knee_pitch += v_delta_joint_angles(5);

    return computed_joint_angles;
}
